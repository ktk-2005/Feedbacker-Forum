<!-- This file is autogenerated, do not modify directly,
     If you wish to edit the contents update the documentation
     comments or the template file: misc/api-template.md -->

# API

## Version

### [GET /api/version](../server/src/routes/version.js#L49)

Retrieve version information about the running server.

Example response
```json
{
  "gitHash": "331d54dc84a46d12e15bdc9e7b16aacf2f2741a9",
  "gitBranch": "develop"
}
```

## Comments

### [GET /api/comments](../server/src/routes/comments.js#L51)

Retrieve all comments of the current container instance.

returns JSON array of all comments grouped with reactions in database
```json
{
    "1bd8052b": {
        "id": "1bd8052b",
        "time": "2018-11-14 16:35:27",
        "text": "comment text",
        "userId": "da776df3",
        "username": "TestUser",
        "threadId": "3blkj3ad",
        "hideName": false,
        "blob": {
           "path": "/path/to/comment",
           "route": "/route/to/comment"
        },
        "reactions": [
            {
                "id": "1ddb07c8",
                "time": "2019-01-16 16:43:21",
                "userId": "da776df3",
                "emoji": "up",
                "commentId": "1bd8052b"
            }
         ]
    },
    "cb38e8f6": {
        "id": "cb38e8f6",
        "time": "2018-11-14 17:10:42",
        "text": "other comment",
        "userId": "da776df3",
        "username": "NewUser",
        "threadId": "3blkj3ad",
        "blob": {
           "route": "/"
        },
        "reactions": []
    }
}
```
### [POST /api/comments](../server/src/routes/comments.js#L105)

Adds comment to the current container instance.

Example body for a root comment
```json
{
  "text": "comment",
  "blob": {
     "route": "/",
     "path": "/path/to/element"
   }
}
```
comments can be linked to a thread with
```json
{
  "text": "thread comment",
  "threadId": "1234",
  "blob": {
     "route": "/",
     "path": "/path/to/element"
   }
}
```

Returns `{ id, threadId }` of the new comment

### [DELETE /api/comments/:id](../server/src/routes/comments.js#L151)

Tries to delete a comment. Only successful if the userId of the comment is the same
as the user trying to delete the comment, or if the user is a dev.

Returns the numbers of rows affected,
one if the comment was deleted and 0 if it was not successful.

e.g.
```json
{
  "delRows": 1
}
```

### [GET /api/comments/:threadId](../server/src/routes/comments.js#L131)

Get comments by `threadId`

returns JSON array of all comments in thread

## Questions

### [GET /api/questions](../server/src/routes/questions.js#L22)

Retrieve all questions in the current container instance.

returns JSON array of all questions of instance
### [POST /api/questions](../server/src/routes/questions.js#L54)

adds question to database.

Example body
```json
{
  "text": "What do you think?",
  "type": "text"
}
```

Returns `{ id }` of the created question

### [DELETE /api/questions/:id](../server/src/routes/questions.js#L85)

Delete a previously posted question
### [PUT /api/questions/:id](../server/src/routes/questions.js#L101)

Update a previously posted question

### [POST /api/questions/order](../server/src/routes/questions.js#L128)

Re-order questions, accepts a body like
```json
{
  order: ['id-1', 'id-2', 'id-3']
}
```

### Answers

### [POST /api/answers](../server/src/routes/answers.js#L14)

adds answer to database

Returns `{ id }` of the added answer

### [GET /api/answers/:questionId](../server/src/routes/answers.js#L29)

Returns answer of a user for specific question
### [PUT /api/answers/:questionId](../server/src/routes/answers.js#L47)

Edits an answer of a user for specific question

## Reactions

### [POST /api/reactions](../server/src/routes/reactions.js#L20)

add reaction to a comment.

Example body
```json
{
  "emoji": "up",
  "commentId": "1bd8052b"
}
```

Returns `{ id }` of the reaction
### [DELETE /api/reactions](../server/src/routes/reactions.js#L37)

Remove reaction from a comment.

Returns empty JSON if deletion was succesful

## Users

### [POST /api/users](../server/src/routes/users.js#L25)

Add user to database.
Returns JSON that contains generated id and secret of added user.
The body can be empty to create a new anonymous user which is the default
mode of interaction in the frontend.
Alternatively you can specify properties for the new user,
eg.
```json
{
  "name": "testuser"
}
```

Example response
```json
{
    "id": "d6ac55e9",
    "secret": "ea2ca2565f484906bfd5096126816a"
}
```
### [PUT /api/users](../server/src/routes/users.js#L69)

Change username of existing user.
The user is specified using the X-Feedback-Auth header as with other endpoints
and the body should contain the new name eg.
```json
{
   "name": "Testuser2",
}
```

### [GET /api/users/role](../server/src/routes/users.js#L99)

Retrieve the role of the current user in the container.
Returns either `"dev"` or `"user"`

Example body
```json
{
  "role": "user"
}
```

## Instances

### [GET /api/instances](../server/src/routes/instances.js#L49)

Retrieve all instances in the database.

Returns 200 OK and a JSON array of all instances or 500 ISE if an error occurred.

### [POST /api/instances/new](../server/src/routes/instances.js#L83)

Create a new instance.

Currently the only parameter considered is `instance_image`. The name and subdomain are
generated automatically.

Example body
```json
{
 "type": "node"
}
```

Returns 200 OK if the operation completed successfully and 500 ISE if an error occurred.

### [GET /api/instances/logs/:name](../server/src/routes/instances.js#L62)

Retrieve logs of an instance.

Returns 200 OK and a string with logs or 500 ISE if an error occurred.

### [POST /api/instances/start](../server/src/routes/instances.js#L174)

Start a stopped container.

Example body
```json
{
 "name": "testapp-ab012"
}
```

Returns 200 OK if the operation completed successfully and 500 ISE if an error occurred.

### [POST /api/instances/stop](../server/src/routes/instances.js#L155)

Stop a running container.

Example body
```json
{
 "name": "testapp-ab012"
}
```

Returns 200 OK if the operation completed successfully and 500 ISE if an error occurred.

### [POST /api/instances/delete](../server/src/routes/instances.js#L193)

Delete a container

Example body
```json
{
 "name": "testapp-ab012"
}
```

Returns 200 OK if the operation completed successfully and 500 ISE if an error occurred.

## Instance runners

### [GET /api/instanceRunners](../server/src/routes/instanceRunners.js#L21)

Retrieve all instance runners in the database and configured system default
runners.

Fields present in the instance objects are: tag, time, use_id, size, status

Returns 200 OK and a JSON array of all instance runners or the system runners
if
  a) the user doesn't have any custom runners or
  b) the user isn't authenticated properly

### [POST /api/instanceRunners/new](../server/src/routes/instanceRunners.js#L47)

Create a new instance runner for the user. The image is pulled from the
Docker Hub. There is currently no limitations on how large or many images a
user can pull.

Example request body:

```json
{
 "tag": "nginx:latest"
}
```

Always returns 200 OK. Readiness should be monitored from `/api/instanceRunners`
in the `status` field.

### [POST /api/instanceRunners/delete](../server/src/routes/instanceRunners.js#L65)

Deletes an instance runner. This will also cleanup space used on disk, so
if per-user quotas are implemented later, this is the way instance runner
management can be done.

Example request body:

```json
{
 "tag": "nginx:latest"
}
```

Always returns 200 OK. Readiness should be monitored from `/api/instanceRunners`
in the `status` field.

## Authorization

### [POST /api/authorization](../server/src/routes/authorization.js#L49)

Authorize user for accessing the specified container.
Required fields in the body: [password, subdomain]
Example request:
```json
{
  "password": "correct horse battery staple",
  "subdomain": "hello-world-abcd23"
}
```

Example response body
```json
{
  "authToken": "0123456789abcdef"
}
```

Returns 200 OK with auth token if the authorization was succesful.
Returns 403 if the authorization was not succesful.

### [POST /api/authorization/retry](../server/src/routes/authorization.js#L23)

Retrieve an existing authentication if one exists.
Required fields in the body: [subdomain]
Example request:
```json
{
  "subdomain": "hello-world-abcd23"
}
```

Example response body
```json
{
  "authToken": "0123456789abcdef"
}
```

Returns 200 OK with auth token if the authorization was succesful.
Returns 401 if the user is not authorized yet.

## Slackbot

### [GET /api/slack/oauth](../server/src/routes/slackbot.js#L24)

Authentication with Slack sign in.
This path should only be called by Slack oauth after pressing 'Sign in with Slack'-button.

Returns error if authentication failed or redirects back to dashboard otherwise

### [POST /api/slack/oauth/connect](../server/src/routes/slackbot.js#L51)

For letting our slack authentication know who user clicked 'Sign in with Slack'-button

Returns redirect to Slack's oauth.

### [GET /api/slack/auth](../server/src/routes/slackbot.js#L69)

For checking if user has connected to Slack

Returns json containing boolean indicating whether connected or not.
Contains slack username and user id if connected as well.

### [POST /api/slack/command/status](../server/src/routes/slackbot.js#L85)

Slack slash status command, should only be called from Slack.

Returns status check if user has connected Slack account to Feedbacker forum.

### [GET /api/slack/notify/:url](../server/src/routes/slackbot.js#L99)

Used for sending slack notifications by webhook when wanting to share published instance.

Returns json object with 'success' boolean field indicating whether notification was send or not.

## GitHub integration

### [GET /api/github/oauth2login](../server/src/routes/github.js#L11)

Returns an url for the Oauth2 redirect.

### [GET /api/github/oauth2callback](../server/src/routes/github.js#L21)

GitHub redirects the user to this url after performing authentication.

### [GET /api/github/status](../server/src/routes/github.js#L30)

Retrieves the registered GitHub login state of the user.

### [GET /api/github/repos/:installationId](../server/src/routes/github.js#L57)

Retrieves user-accessable repositories by installation id. A list of
available ids is container in the /api/github/status response.

### [POST /api/github/logout](../server/src/routes/github.js#L46)

Removes the stored access token for github
## CORS

### [OPTIONS /*](../server/src/cors.js#L6)

Return CORS headers for all OPTIONS requests

