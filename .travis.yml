sudo: required

dist: trusty
language: node_js
node_js:
  - "10.3.0"

services:
  - docker

before_install:
  - npm install -g npm@6.4.1
  - docker pull node:10.13-alpine
  - docker pull nginx:alpine

install:
  - cd client && npm install && cd ..
  - cd server && npm install && cd ..

script:
  - npm --prefix client run lint
  - npm --prefix client run lint:ci
  - npm --prefix client run build:dev
  - npm --prefix client run build
  - npm --prefix server run lint
  - npm --prefix server run lint:ci
  - APP_SERVER_PORT=9001 npm --prefix server start &
  - APP_SERVER_PORT=9001 npm --prefix server run test:api
  - curl -s localhost:9001/test.html > /dev/null
  - pushd docker/development; docker-compose up; popd
  - APP_SERVER_PORT=8080 npm --prefix server run test:api
  - curl -s localhost:8080/test.html > /dev/null
  - pushd docker/development; docker-compose down; popd
  - pushd docker/production; docker-compose up; popd
  - APP_SERVER_PORT=8080 npm --prefix server run test:api
  - curl -s localhost:8080/test.html > /dev/null
  - pushd docker/production; docker-compose down; popd

